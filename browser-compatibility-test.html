<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブラウザ互換性テスト - UI Animation Enhancement</title>
    <style>
        body {
            font-family: 'YuGothic', 'Yu Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5dc;
            color: #dc143c;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .browser-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #dc143c;
        }
        
        .feature-test {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .feature-test h3 {
            margin-top: 0;
            color: #8b0000;
        }
        
        .test-result {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        
        .supported {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .not-supported {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .partial {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .compatibility-score {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        
        .score-excellent { background: #d4edda; color: #155724; }
        .score-good { background: #d1ecf1; color: #0c5460; }
        .score-fair { background: #fff3cd; color: #856404; }
        .score-poor { background: #f8d7da; color: #721c24; }
        
        .test-details {
            margin: 10px 0;
            font-size: 0.9em;
            color: #666;
        }
        
        .animation-demo {
            width: 50px;
            height: 50px;
            background: #dc143c;
            margin: 10px 0;
            border-radius: 50%;
        }
        
        .css-animation-test {
            animation: testAnimation 2s infinite;
        }
        
        @keyframes testAnimation {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(100px); }
        }
        
        .css-transition-test {
            transition: transform 0.5s ease;
        }
        
        .css-transition-test:hover {
            transform: scale(1.2);
        }
        
        .css-transform-test {
            transform: rotate(45deg);
        }
        
        .grid-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .flex-test {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .custom-property-test {
            --test-color: #dc143c;
            color: var(--test-color);
        }
        
        .will-change-test {
            will-change: transform;
        }
        
        .test-button {
            background: #8b0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #a0001a;
        }
        
        .fallback-test {
            background: linear-gradient(90deg, #dc143c, #8b0000);
            background: #dc143c; /* Fallback for older browsers */
            padding: 10px;
            color: white;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🌐 ブラウザ互換性テスト</h1>
        
        <div class="browser-info" id="browserInfo">
            <h2>ブラウザ情報</h2>
            <div id="browserDetails">読み込み中...</div>
        </div>
        
        <div class="compatibility-score" id="compatibilityScore">
            互換性スコア計算中...
        </div>
        
        <div class="feature-test">
            <h3>🎨 CSS機能サポート</h3>
            <div id="cssFeatures"></div>
            
            <h4>CSS Animation テスト</h4>
            <div class="animation-demo css-animation-test"></div>
            <div class="test-details">上の円が左右に動いていれば CSS Animation がサポートされています</div>
            
            <h4>CSS Transition テスト</h4>
            <div class="animation-demo css-transition-test"></div>
            <div class="test-details">上の円にマウスを乗せて拡大すれば CSS Transition がサポートされています</div>
            
            <h4>CSS Transform テスト</h4>
            <div class="animation-demo css-transform-test"></div>
            <div class="test-details">上の円が45度回転していれば CSS Transform がサポートされています</div>
            
            <h4>CSS Grid テスト</h4>
            <div class="grid-test">
                <div style="background: #dc143c; color: white; padding: 10px;">Grid 1</div>
                <div style="background: #8b0000; color: white; padding: 10px;">Grid 2</div>
            </div>
            <div class="test-details">上の2つのボックスが横並びなら CSS Grid がサポートされています</div>
            
            <h4>CSS Flexbox テスト</h4>
            <div class="flex-test">
                <div style="background: #dc143c; color: white; padding: 10px;">Flex 1</div>
                <div style="background: #8b0000; color: white; padding: 10px;">Flex 2</div>
            </div>
            <div class="test-details">上の2つのボックスが両端に配置されていれば Flexbox がサポートされています</div>
            
            <h4>CSS Custom Properties テスト</h4>
            <div class="custom-property-test">このテキストが赤色なら CSS Custom Properties がサポートされています</div>
            
            <h4>CSS Gradient テスト</h4>
            <div class="fallback-test">このボックスがグラデーションなら CSS Gradient がサポートされています</div>
        </div>
        
        <div class="feature-test">
            <h3>⚡ JavaScript API サポート</h3>
            <div id="jsFeatures"></div>
            
            <h4>Intersection Observer テスト</h4>
            <div id="intersectionTest">テスト実行中...</div>
            
            <h4>Performance API テスト</h4>
            <div id="performanceTest">テスト実行中...</div>
            
            <h4>Local Storage テスト</h4>
            <div id="storageTest">テスト実行中...</div>
        </div>
        
        <div class="feature-test">
            <h3>📱 デバイス・入力サポート</h3>
            <div id="deviceFeatures"></div>
        </div>
        
        <div class="feature-test">
            <h3>🎯 アニメーション最適化機能</h3>
            <div id="animationFeatures"></div>
        </div>
        
        <div class="feature-test">
            <h3>🔧 実際のアニメーション動作テスト</h3>
            <button class="test-button" onclick="testActualAnimations()">アニメーション動作テスト実行</button>
            <div id="animationTestResults"></div>
        </div>
        
        <div class="feature-test">
            <h3>📊 詳細テスト結果</h3>
            <button class="test-button" onclick="exportResults()">結果をJSONでエクスポート</button>
            <button class="test-button" onclick="runFullCompatibilityTest()">完全互換性テスト実行</button>
            <div id="detailedResults"></div>
        </div>
    </div>

    <script>
        class BrowserCompatibilityTester {
            constructor() {
                this.results = {
                    browser: {},
                    cssFeatures: {},
                    jsFeatures: {},
                    deviceFeatures: {},
                    animationFeatures: {},
                    score: 0,
                    recommendations: []
                };
                
                this.init();
            }
            
            init() {
                this.detectBrowser();
                this.testCSSFeatures();
                this.testJSFeatures();
                this.testDeviceFeatures();
                this.testAnimationFeatures();
                this.calculateScore();
                this.displayResults();
            }
            
            detectBrowser() {
                const ua = navigator.userAgent;
                const browser = {
                    userAgent: ua,
                    vendor: navigator.vendor || '',
                    platform: navigator.platform || '',
                    language: navigator.language || '',
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                    deviceMemory: navigator.deviceMemory || 'Unknown',
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt
                    } : null
                };
                
                // ブラウザ名の推定
                if (ua.includes('Chrome') && !ua.includes('Edge')) {
                    browser.name = 'Chrome';
                    browser.engine = 'Blink';
                } else if (ua.includes('Firefox')) {
                    browser.name = 'Firefox';
                    browser.engine = 'Gecko';
                } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                    browser.name = 'Safari';
                    browser.engine = 'WebKit';
                } else if (ua.includes('Edge')) {
                    browser.name = 'Edge';
                    browser.engine = 'Blink';
                } else if (ua.includes('Opera')) {
                    browser.name = 'Opera';
                    browser.engine = 'Blink';
                } else {
                    browser.name = 'Unknown';
                    browser.engine = 'Unknown';
                }
                
                this.results.browser = browser;
                
                // ブラウザ情報を表示
                document.getElementById('browserDetails').innerHTML = `
                    <strong>ブラウザ:</strong> ${browser.name}<br>
                    <strong>エンジン:</strong> ${browser.engine}<br>
                    <strong>プラットフォーム:</strong> ${browser.platform}<br>
                    <strong>言語:</strong> ${browser.language}<br>
                    <strong>CPU コア数:</strong> ${browser.hardwareConcurrency}<br>
                    <strong>メモリ:</strong> ${browser.deviceMemory}GB<br>
                    <strong>接続:</strong> ${browser.connection ? browser.connection.effectiveType : 'Unknown'}
                `;
            }
            
            testCSSFeatures() {
                const features = {
                    'CSS Animations': this.testCSSAnimations(),
                    'CSS Transitions': this.testCSSTransitions(),
                    'CSS Transforms': this.testCSSTransforms(),
                    'CSS Grid': this.testCSSGrid(),
                    'CSS Flexbox': this.testCSSFlexbox(),
                    'CSS Custom Properties': this.testCSSCustomProperties(),
                    'CSS Gradients': this.testCSSGradients(),
                    'CSS will-change': this.testCSSWillChange(),
                    'CSS calc()': this.testCSSCalc(),
                    'CSS Media Queries': this.testCSSMediaQueries(),
                    'CSS @supports': this.testCSSSupports()
                };
                
                this.results.cssFeatures = features;
                
                const container = document.getElementById('cssFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? '✓' : '✗'}
                    </span>`
                ).join('');
            }
            
            testCSSAnimations() {
                return CSS.supports('animation', 'test 1s') || 
                       CSS.supports('-webkit-animation', 'test 1s') ||
                       CSS.supports('-moz-animation', 'test 1s');
            }
            
            testCSSTransitions() {
                return CSS.supports('transition', 'all 1s') ||
                       CSS.supports('-webkit-transition', 'all 1s') ||
                       CSS.supports('-moz-transition', 'all 1s');
            }
            
            testCSSTransforms() {
                return CSS.supports('transform', 'translateX(0)') ||
                       CSS.supports('-webkit-transform', 'translateX(0)') ||
                       CSS.supports('-moz-transform', 'translateX(0)');
            }
            
            testCSSGrid() {
                return CSS.supports('display', 'grid');
            }
            
            testCSSFlexbox() {
                return CSS.supports('display', 'flex') ||
                       CSS.supports('display', '-webkit-flex');
            }
            
            testCSSCustomProperties() {
                return CSS.supports('--test', '0') || CSS.supports('color', 'var(--test)');
            }
            
            testCSSGradients() {
                return CSS.supports('background', 'linear-gradient(red, blue)') ||
                       CSS.supports('background', '-webkit-linear-gradient(red, blue)');
            }
            
            testCSSWillChange() {
                return CSS.supports('will-change', 'transform');
            }
            
            testCSSCalc() {
                return CSS.supports('width', 'calc(100% - 10px)');
            }
            
            testCSSMediaQueries() {
                return window.matchMedia && window.matchMedia('(min-width: 1px)').matches;
            }
            
            testCSSSupports() {
                return typeof CSS !== 'undefined' && typeof CSS.supports === 'function';
            }
            
            testJSFeatures() {
                const features = {
                    'Intersection Observer': 'IntersectionObserver' in window,
                    'Mutation Observer': 'MutationObserver' in window,
                    'Performance API': 'performance' in window && 'now' in performance,
                    'RequestAnimationFrame': 'requestAnimationFrame' in window,
                    'Local Storage': this.testLocalStorage(),
                    'Session Storage': this.testSessionStorage(),
                    'Fetch API': 'fetch' in window,
                    'Promise': 'Promise' in window,
                    'Arrow Functions': this.testArrowFunctions(),
                    'ES6 Classes': this.testES6Classes(),
                    'Template Literals': this.testTemplateLiterals(),
                    'Async/Await': this.testAsyncAwait(),
                    'Web Workers': 'Worker' in window,
                    'Service Workers': 'serviceWorker' in navigator,
                    'Geolocation': 'geolocation' in navigator,
                    'Device Orientation': 'DeviceOrientationEvent' in window,
                    'Touch Events': 'ontouchstart' in window,
                    'Pointer Events': 'PointerEvent' in window
                };
                
                this.results.jsFeatures = features;
                
                const container = document.getElementById('jsFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? '✓' : '✗'}
                    </span>`
                ).join('');
                
                // 個別テスト実行
                this.runIntersectionObserverTest();
                this.runPerformanceTest();
                this.runStorageTest();
            }
            
            testLocalStorage() {
                try {
                    const test = 'test';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testSessionStorage() {
                try {
                    const test = 'test';
                    sessionStorage.setItem(test, test);
                    sessionStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testArrowFunctions() {
                try {
                    eval('() => {}');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testES6Classes() {
                try {
                    eval('class Test {}');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testTemplateLiterals() {
                try {
                    eval('`template`');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testAsyncAwait() {
                try {
                    eval('async function test() { await Promise.resolve(); }');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            runIntersectionObserverTest() {
                const container = document.getElementById('intersectionTest');
                
                if ('IntersectionObserver' in window) {
                    try {
                        const observer = new IntersectionObserver(() => {});
                        observer.disconnect();
                        container.innerHTML = '<span class="test-result supported">Intersection Observer: ✓ 動作確認済み</span>';
                    } catch (e) {
                        container.innerHTML = '<span class="test-result not-supported">Intersection Observer: ✗ エラー発生</span>';
                    }
                } else {
                    container.innerHTML = '<span class="test-result not-supported">Intersection Observer: ✗ 未サポート</span>';
                }
            }
            
            runPerformanceTest() {
                const container = document.getElementById('performanceTest');
                
                if ('performance' in window && 'now' in performance) {
                    try {
                        const start = performance.now();
                        const end = performance.now();
                        const duration = end - start;
                        container.innerHTML = `<span class="test-result supported">Performance API: ✓ 動作確認済み (${duration.toFixed(2)}ms)</span>`;
                    } catch (e) {
                        container.innerHTML = '<span class="test-result not-supported">Performance API: ✗ エラー発生</span>';
                    }
                } else {
                    container.innerHTML = '<span class="test-result not-supported">Performance API: ✗ 未サポート</span>';
                }
            }
            
            runStorageTest() {
                const container = document.getElementById('storageTest');
                
                const localStorageSupported = this.testLocalStorage();
                const sessionStorageSupported = this.testSessionStorage();
                
                container.innerHTML = `
                    <span class="test-result ${localStorageSupported ? 'supported' : 'not-supported'}">
                        Local Storage: ${localStorageSupported ? '✓' : '✗'}
                    </span>
                    <span class="test-result ${sessionStorageSupported ? 'supported' : 'not-supported'}">
                        Session Storage: ${sessionStorageSupported ? '✓' : '✗'}
                    </span>
                `;
            }
            
            testDeviceFeatures() {
                const features = {
                    'Touch Support': 'ontouchstart' in window || navigator.maxTouchPoints > 0,
                    'Pointer Events': 'PointerEvent' in window,
                    'Device Orientation': 'DeviceOrientationEvent' in window,
                    'Device Motion': 'DeviceMotionEvent' in window,
                    'Vibration': 'vibrate' in navigator,
                    'Battery API': 'getBattery' in navigator,
                    'Network Information': 'connection' in navigator,
                    'Media Queries': window.matchMedia && window.matchMedia('(hover: hover)').media !== 'not all',
                    'Reduced Motion': window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches,
                    'High Contrast': window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches,
                    'Dark Mode': window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
                };
                
                this.results.deviceFeatures = features;
                
                const container = document.getElementById('deviceFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? '✓' : '✗'}
                    </span>`
                ).join('');
            }
            
            testAnimationFeatures() {
                const features = {
                    'GPU Acceleration': this.testGPUAcceleration(),
                    'Hardware Acceleration': this.testHardwareAcceleration(),
                    '60fps Support': this.test60FPSSupport(),
                    'Smooth Scrolling': this.testSmoothScrolling(),
                    'Backface Visibility': this.testBackfaceVisibility(),
                    'Transform 3D': this.testTransform3D(),
                    'Perspective': this.testPerspective(),
                    'Filter Effects': this.testFilterEffects(),
                    'Backdrop Filter': this.testBackdropFilter(),
                    'Clip Path': this.testClipPath()
                };
                
                this.results.animationFeatures = features;
                
                const container = document.getElementById('animationFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? '✓' : '✗'}
                    </span>`
                ).join('');
            }
            
            testGPUAcceleration() {
                return CSS.supports('transform', 'translateZ(0)') ||
                       CSS.supports('transform', 'translate3d(0,0,0)');
            }
            
            testHardwareAcceleration() {
                return CSS.supports('will-change', 'transform') ||
                       CSS.supports('transform', 'translateZ(0)');
            }
            
            test60FPSSupport() {
                return 'requestAnimationFrame' in window;
            }
            
            testSmoothScrolling() {
                return CSS.supports('scroll-behavior', 'smooth');
            }
            
            testBackfaceVisibility() {
                return CSS.supports('backface-visibility', 'hidden') ||
                       CSS.supports('-webkit-backface-visibility', 'hidden');
            }
            
            testTransform3D() {
                return CSS.supports('transform', 'rotateX(0deg)') ||
                       CSS.supports('-webkit-transform', 'rotateX(0deg)');
            }
            
            testPerspective() {
                return CSS.supports('perspective', '1000px') ||
                       CSS.supports('-webkit-perspective', '1000px');
            }
            
            testFilterEffects() {
                return CSS.supports('filter', 'blur(5px)') ||
                       CSS.supports('-webkit-filter', 'blur(5px)');
            }
            
            testBackdropFilter() {
                return CSS.supports('backdrop-filter', 'blur(5px)') ||
                       CSS.supports('-webkit-backdrop-filter', 'blur(5px)');
            }
            
            testClipPath() {
                return CSS.supports('clip-path', 'circle(50%)') ||
                       CSS.supports('-webkit-clip-path', 'circle(50%)');
            }
            
            calculateScore() {
                let totalFeatures = 0;
                let supportedFeatures = 0;
                
                // CSS機能のスコア計算（重み: 30%）
                const cssFeatures = Object.values(this.results.cssFeatures);
                totalFeatures += cssFeatures.length * 0.3;
                supportedFeatures += cssFeatures.filter(Boolean).length * 0.3;
                
                // JavaScript機能のスコア計算（重み: 25%）
                const jsFeatures = Object.values(this.results.jsFeatures);
                totalFeatures += jsFeatures.length * 0.25;
                supportedFeatures += jsFeatures.filter(Boolean).length * 0.25;
                
                // デバイス機能のスコア計算（重み: 20%）
                const deviceFeatures = Object.values(this.results.deviceFeatures);
                totalFeatures += deviceFeatures.length * 0.2;
                supportedFeatures += deviceFeatures.filter(Boolean).length * 0.2;
                
                // アニメーション機能のスコア計算（重み: 25%）
                const animationFeatures = Object.values(this.results.animationFeatures);
                totalFeatures += animationFeatures.length * 0.25;
                supportedFeatures += animationFeatures.filter(Boolean).length * 0.25;
                
                this.results.score = Math.round((supportedFeatures / totalFeatures) * 100);
            }
            
            displayResults() {
                const scoreContainer = document.getElementById('compatibilityScore');
                const score = this.results.score;
                
                let scoreClass, scoreText;
                if (score >= 90) {
                    scoreClass = 'score-excellent';
                    scoreText = '優秀 - 完全互換';
                } else if (score >= 75) {
                    scoreClass = 'score-good';
                    scoreText = '良好 - 高互換性';
                } else if (score >= 60) {
                    scoreClass = 'score-fair';
                    scoreText = '普通 - 基本互換性';
                } else {
                    scoreClass = 'score-poor';
                    scoreText = '要改善 - 低互換性';
                }
                
                scoreContainer.className = `compatibility-score ${scoreClass}`;
                scoreContainer.innerHTML = `
                    互換性スコア: ${score}/100<br>
                    <small>${scoreText}</small>
                `;
                
                // 推奨事項の生成
                this.generateRecommendations();
            }
            
            generateRecommendations() {
                const recommendations = [];
                
                // 重要な機能の未サポートをチェック
                if (!this.results.cssFeatures['CSS Animations']) {
                    recommendations.push('CSS Animations が未サポートです。フォールバック処理を実装してください。');
                }
                
                if (!this.results.cssFeatures['CSS Transitions']) {
                    recommendations.push('CSS Transitions が未サポートです。即座の状態変更を検討してください。');
                }
                
                if (!this.results.jsFeatures['Intersection Observer']) {
                    recommendations.push('Intersection Observer が未サポートです。スクロールイベントのポリフィルを検討してください。');
                }
                
                if (!this.results.jsFeatures['RequestAnimationFrame']) {
                    recommendations.push('RequestAnimationFrame が未サポートです。setTimeoutでのフォールバックを実装してください。');
                }
                
                if (!this.results.animationFeatures['GPU Acceleration']) {
                    recommendations.push('GPU加速が未サポートです。アニメーションパフォーマンスが低下する可能性があります。');
                }
                
                if (this.results.deviceFeatures['Reduced Motion']) {
                    recommendations.push('ユーザーがアニメーション軽減を設定しています。アニメーションを無効化または簡素化してください。');
                }
                
                this.results.recommendations = recommendations;
            }
        }
        
        // グローバル関数
        let compatibilityTester;
        
        function testActualAnimations() {
            const container = document.getElementById('animationTestResults');
            container.innerHTML = '<p>アニメーション動作テスト実行中...</p>';
            
            // 実際のアニメーション要素をテスト
            const testElement = document.createElement('div');
            testElement.style.cssText = `
                width: 50px;
                height: 50px;
                background: #dc143c;
                position: relative;
                margin: 10px 0;
                transition: transform 0.5s ease;
                animation: testAnimation 2s infinite;
            `;
            
            container.appendChild(testElement);
            
            setTimeout(() => {
                const computedStyle = window.getComputedStyle(testElement);
                const hasAnimation = computedStyle.animationName !== 'none';
                const hasTransition = computedStyle.transitionProperty !== 'none';
                
                let results = '<h4>実際のアニメーション動作結果:</h4>';
                results += `<span class="test-result ${hasAnimation ? 'supported' : 'not-supported'}">
                    CSS Animation: ${hasAnimation ? '✓ 動作中' : '✗ 動作せず'}
                </span>`;
                results += `<span class="test-result ${hasTransition ? 'supported' : 'not-supported'}">
                    CSS Transition: ${hasTransition ? '✓ 設定済み' : '✗ 未設定'}
                </span>`;
                
                // パフォーマンス測定
                const startTime = performance.now();
                let frameCount = 0;
                
                function measureFPS() {
                    frameCount++;
                    if (frameCount < 60) {
                        requestAnimationFrame(measureFPS);
                    } else {
                        const endTime = performance.now();
                        const fps = Math.round(60000 / (endTime - startTime));
                        results += `<span class="test-result ${fps >= 30 ? 'supported' : 'not-supported'}">
                            FPS: ${fps} ${fps >= 30 ? '(良好)' : '(要改善)'}
                        </span>`;
                        
                        container.innerHTML = results;
                    }
                }
                
                if ('requestAnimationFrame' in window) {
                    requestAnimationFrame(measureFPS);
                } else {
                    results += '<span class="test-result not-supported">FPS測定: ✗ RequestAnimationFrame未サポート</span>';
                    container.innerHTML = results;
                }
                
            }, 1000);
        }
        
        function exportResults() {
            const results = compatibilityTester.results;
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `browser-compatibility-${Date.now()}.json`;
            link.click();
        }
        
        function runFullCompatibilityTest() {
            const container = document.getElementById('detailedResults');
            container.innerHTML = '<p>完全互換性テスト実行中...</p>';
            
            // より詳細なテストを実行
            const detailedTests = {
                'WebGL Support': testWebGL(),
                'Canvas Support': testCanvas(),
                'SVG Support': testSVG(),
                'Video Support': testVideo(),
                'Audio Support': testAudio(),
                'WebP Support': testWebP(),
                'AVIF Support': testAVIF(),
                'HTTP/2 Support': testHTTP2(),
                'ES6 Modules': testES6Modules(),
                'Web Components': testWebComponents()
            };
            
            let results = '<h4>詳細互換性テスト結果:</h4>';
            Object.entries(detailedTests).forEach(([test, supported]) => {
                results += `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                    ${test}: ${supported ? '✓' : '✗'}
                </span>`;
            });
            
            // 推奨事項の表示
            if (compatibilityTester.results.recommendations.length > 0) {
                results += '<h4>推奨事項:</h4><ul>';
                compatibilityTester.results.recommendations.forEach(rec => {
                    results += `<li>${rec}</li>`;
                });
                results += '</ul>';
            }
            
            container.innerHTML = results;
        }
        
        // 詳細テスト関数
        function testWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
            } catch (e) {
                return false;
            }
        }
        
        function testCanvas() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext && canvas.getContext('2d'));
            } catch (e) {
                return false;
            }
        }
        
        function testSVG() {
            return !!(document.createElementNS && document.createElementNS('http://www.w3.org/2000/svg', 'svg').createSVGRect);
        }
        
        function testVideo() {
            return !!document.createElement('video').canPlayType;
        }
        
        function testAudio() {
            return !!document.createElement('audio').canPlayType;
        }
        
        function testWebP() {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 1;
            return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
        }
        
        function testAVIF() {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 1;
            try {
                return canvas.toDataURL('image/avif').indexOf('data:image/avif') === 0;
            } catch (e) {
                return false;
            }
        }
        
        function testHTTP2() {
            // HTTP/2の直接テストは困難なので、関連機能をチェック
            return 'serviceWorker' in navigator && 'fetch' in window;
        }
        
        function testES6Modules() {
            try {
                return typeof Symbol !== 'undefined' && 'import' in document.createElement('script');
            } catch (e) {
                return false;
            }
        }
        
        function testWebComponents() {
            return 'customElements' in window && 'attachShadow' in Element.prototype;
        }
        
        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            compatibilityTester = new BrowserCompatibilityTester();
        });
    </script>
</body>
</html>
