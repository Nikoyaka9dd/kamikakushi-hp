<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消えない祭りは神隠し</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Skip link for keyboard navigation -->
    <a href="#main-content" class="skip-link">メインコンテンツにスキップ</a>
    
    <div class="scroll-indicator">
        <div class="scroll-progress" id="scrollProgress"></div>
    </div>
    
    <div id="interactive-effects-container"></div>

    <div class="container" id="main-content" tabindex="-1">
        <div class="red-decoration red-decoration-left" aria-hidden="true"></div>
        <div class="red-decoration red-decoration-right" aria-hidden="true"></div>

        <div class="main-logo">
            <h1 class="vertical-text vertical-text-top-right">
                <span>あ</span><span>な</span><span>た</span><span>も</span>
            </h1>
            <img src="assets/title.gif" alt="消えない祭りは神隠し" class="main-gif" id="mainGif">
            <h2 class="vertical-text vertical-text-bottom-left">
                <span>物</span><span>語</span><span>の</span><span>登</span><span>場</span><span>人</span><span>物</span><span>に</span>
            </h2>
            <img src="assets/kumoleft.PNG" alt="" class="cloud-image cloud-left">
            <img src="assets/kumoright.PNG" alt="" class="cloud-image cloud-right">
        </div>
        
        <div class="scroll-content-wrapper">
            <p class="sub-catchcopy fade-in-element">京大初の没入型演劇<br>学園祭の2日間限定でお届けします</p>
            <div class="event-details-section fade-in-element">
                <div class="event-header">
                    <p>京都大学</p>
                    <h2>学園祭</h2>
                </div>

                <div class="date-image-container">
                    <img src="assets/date.PNG" alt="開催日時: 11月23日、24日">
                </div>
                
                <div class="character-icon icon-fox">
                    <img src="assets/kitune.png" alt="狐のキャラクターイラスト">
                </div>

                <button class="reserve-button-main fade-in-element">予約はこちら</button>

                <div class="character-icon icon-crow">
                     <img src="assets/karasu.png" alt="鴉のキャラクターイラスト">
                </div>

                <div class="event-cloud event-cloud-1">
                    <img src="assets/kumoright.PNG" alt="">
                </div>
                 <div class="event-cloud event-cloud-2">
                    <img src="assets/kumoleft.PNG" alt="">
                </div>
            </div>

            <div class="attraction-section fade-in-element">
                <h2 class="attraction-title">公演の魅力</h2>
                <div class="attraction-content">
                    <div class="attraction-item">
                        <div class="attraction-number">1</div>
                        <div class="attraction-text">
                            <h3>あなたが物語に参加する<br>完全没入体験</h3>
                            <p>ただ観るだけの演劇ではありません。役者と関わり、あなたの選択で物語が変わる登場人物として行動する特別な体験です。</p>
                        </div>
                    </div>
                    <div class="attraction-item">
                        <div class="attraction-number">2</div>
                        <div class="attraction-text">
                            <h3>小学生から大人まで<br>誰でも楽しめる</h3>
                            <p>特別な知識や経験は要りません。子どもから大人まで、誰もが安心して楽しめ、日常を飛び出すワクワクを味わえます。</p>
                        </div>
                    </div>
                    <div class="attraction-item">
                        <div class="attraction-number">3</div>
                        <div class="attraction-text">
                            <h3>キャンパス全体に<br>広がる世界観</h3>
                            <p>私たちが手がけるのは会場内だけではありません。京大北部キャンパス全体が物語の舞台となり、歩くだけでワクワクが高まる特別な体験が広がります。</p>
                        </div>
                    </div>
                </div>
                <div class="character-icon icon-kama">
                    <img src="assets/kama.png" alt="かま">
               </div>
               <div class="character-icon icon-kome">
                <img src="assets/kome.png" alt="こめ">
           </div>
            </div>
            
            <div class="cloud-path-section fade-in-element">
                <div class="cloud-path-item from-left"><img src="assets/kumoright.png" alt=""></div>
                <div class="cloud-path-item from-right"><img src="assets/kumoleft.png" alt=""></div>
                <div class="cloud-path-item from-left"><img src="assets/kumoleft.png" alt=""></div>
                <div class="cloud-path-item from-right"><img src="assets/kumoright.png" alt=""></div>
                <div class="cloud-path-item from-left"><img src="assets/kumoleft.png" alt=""></div>
            </div>

            <div class="worldview-section fade-in-element">
                <h2 class="worldview-title">世界観</h2>
                <div class="worldview-text">
                    <div class="worldview-paragraph-group">
                        <p>ここに世界観説明が入ります。ひとつながりの文章です。</p>
                    </div>
                </div>
                <button class="reserve-button-main fade-in-element">予約はこちら</button>
            </div>
        </div>
    </div>
    
    <a href="#main-content" class="back-to-top-button" aria-label="ページのトップに戻る">
        <img src="assets/heru.PNG" alt="ヘルメース" class="btt-character">
        <div class="btt-icon-wrapper">
            <svg class="btt-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
        </div>
    </a>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Intersection Observerのセットアップ
            const observerOptions = {
                threshold: 0.1, // 要素が10%見えたらトリガー
                rootMargin: "0px 0px -50px 0px" // 少し早めにトリガー
            };

            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        obs.unobserve(entry.target); // 一度表示されたら監視を解除
                    }
                });
            }, observerOptions);

            // 監視対象の要素をすべて取得して監視を開始
            const elementsToAnimate = document.querySelectorAll('.fade-in-element, .attraction-section, .cloud-path-section, .worldview-section');
            elementsToAnimate.forEach(el => observer.observe(el));

            // スクロールプログレスバー
            const scrollProgress = document.getElementById('scrollProgress');
            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                if(scrollProgress) {
                    scrollProgress.style.width = scrollPercent + '%';
                }
            }, { passive: true });
            
            // GIFを静止画像に差し替える
            initGifReplacement();

            // インタラクティブエフェクトの初期化
            initInteractiveEffects();
            
            // トップへ戻るボタンの表示・非表示
            initBackToTopButton();
        });

        // GIFを静止画像に差し替える関数
        function initGifReplacement() {
            const mainGif = document.getElementById('mainGif');
            if (!mainGif) {
                console.error('GIF replacement: mainGif element not found.');
                return;
            }

            const animationStartDelay = 2800;
            const timeAfterDisplay = 4000;
            const swapDelay = animationStartDelay + timeAfterDisplay; 

            setTimeout(() => {
                const staticImageUrl = 'assets/title_static.png'; 
                const staticImage = new Image();
                staticImage.onload = () => {
                    mainGif.src = staticImageUrl;
                };
                staticImage.onerror = () => {
                    console.error(`Failed to load static image: ${staticImageUrl}`);
                };
                staticImage.src = staticImageUrl;
            }, swapDelay);
        }

        // マウス追従 & クリックエフェクトの関数
        function initInteractiveEffects() {
            const container = document.getElementById('interactive-effects-container');
            if (!container) return;

            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

            if (!isTouchDevice) {
                document.addEventListener('mousemove', (e) => {
                    const particle = document.createElement('div');
                    particle.className = 'mouse-particle';
                    particle.style.left = `${e.clientX}px`;
                    particle.style.top = `${e.clientY}px`;
                    container.appendChild(particle);

                    particle.addEventListener('animationend', () => {
                        particle.remove();
                    });
                }, { passive: true });
            }

            const createConfetti = (x, y) => {
                const confettiCount = isTouchDevice ? 20 : 30;
                for (let i = 0; i < confettiCount; i++) {
                    const piece = document.createElement('div');
                    piece.className = 'confetti-piece';
                    
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.random() * (isTouchDevice ? 150 : 250) + 50;
                    const endX = Math.cos(angle) * radius;
                    const endY = Math.sin(angle) * radius;
                    const rotation = Math.random() * 360 * 2 - 360;

                    piece.style.setProperty('--end-x', `${endX}px`);
                    piece.style.setProperty('--end-y', `${endY}px`);
                    piece.style.setProperty('--rotation', `${rotation}deg`);
                    piece.style.background = `hsl(${Math.random() * 60 + 30}, 90%, 60%)`;
                    piece.style.left = `${x}px`;
                    piece.style.top = `${y}px`;

                    container.appendChild(piece);
                    piece.addEventListener('animationend', () => {
                        piece.remove();
                    });
                }
            };
            
            document.addEventListener('click', (e) => {
                createConfetti(e.clientX, e.clientY);
            });
        }
        
        // トップへ戻るボタンの関数
        function initBackToTopButton() {
            const button = document.querySelector('.back-to-top-button');
            if (!button) return;
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > window.innerHeight * 0.8) { // 画面の80%をスクロールしたら表示
                    button.classList.add('is-visible');
                } else {
                    button.classList.remove('is-visible');
                }
            }, { passive: true });
            
            button.addEventListener('click', (e) => {
                e.preventDefault();
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
    </script>
</body>
</html>

