<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆ - UI Animation Enhancement</title>
    <style>
        body {
            font-family: 'YuGothic', 'Yu Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5dc;
            color: #dc143c;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .browser-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #dc143c;
        }
        
        .feature-test {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .feature-test h3 {
            margin-top: 0;
            color: #8b0000;
        }
        
        .test-result {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        
        .supported {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .not-supported {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .partial {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .compatibility-score {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        
        .score-excellent { background: #d4edda; color: #155724; }
        .score-good { background: #d1ecf1; color: #0c5460; }
        .score-fair { background: #fff3cd; color: #856404; }
        .score-poor { background: #f8d7da; color: #721c24; }
        
        .test-details {
            margin: 10px 0;
            font-size: 0.9em;
            color: #666;
        }
        
        .animation-demo {
            width: 50px;
            height: 50px;
            background: #dc143c;
            margin: 10px 0;
            border-radius: 50%;
        }
        
        .css-animation-test {
            animation: testAnimation 2s infinite;
        }
        
        @keyframes testAnimation {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(100px); }
        }
        
        .css-transition-test {
            transition: transform 0.5s ease;
        }
        
        .css-transition-test:hover {
            transform: scale(1.2);
        }
        
        .css-transform-test {
            transform: rotate(45deg);
        }
        
        .grid-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .flex-test {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .custom-property-test {
            --test-color: #dc143c;
            color: var(--test-color);
        }
        
        .will-change-test {
            will-change: transform;
        }
        
        .test-button {
            background: #8b0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #a0001a;
        }
        
        .fallback-test {
            background: linear-gradient(90deg, #dc143c, #8b0000);
            background: #dc143c; /* Fallback for older browsers */
            padding: 10px;
            color: white;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="browser-info" id="browserInfo">
            <h2>ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±</h2>
            <div id="browserDetails">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
        
        <div class="compatibility-score" id="compatibilityScore">
            äº’æ›æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—ä¸­...
        </div>
        
        <div class="feature-test">
            <h3>ğŸ¨ CSSæ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆ</h3>
            <div id="cssFeatures"></div>
            
            <h4>CSS Animation ãƒ†ã‚¹ãƒˆ</h4>
            <div class="animation-demo css-animation-test"></div>
            <div class="test-details">ä¸Šã®å††ãŒå·¦å³ã«å‹•ã„ã¦ã„ã‚Œã° CSS Animation ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
            
            <h4>CSS Transition ãƒ†ã‚¹ãƒˆ</h4>
            <div class="animation-demo css-transition-test"></div>
            <div class="test-details">ä¸Šã®å††ã«ãƒã‚¦ã‚¹ã‚’ä¹—ã›ã¦æ‹¡å¤§ã™ã‚Œã° CSS Transition ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
            
            <h4>CSS Transform ãƒ†ã‚¹ãƒˆ</h4>
            <div class="animation-demo css-transform-test"></div>
            <div class="test-details">ä¸Šã®å††ãŒ45åº¦å›è»¢ã—ã¦ã„ã‚Œã° CSS Transform ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
            
            <h4>CSS Grid ãƒ†ã‚¹ãƒˆ</h4>
            <div class="grid-test">
                <div style="background: #dc143c; color: white; padding: 10px;">Grid 1</div>
                <div style="background: #8b0000; color: white; padding: 10px;">Grid 2</div>
            </div>
            <div class="test-details">ä¸Šã®2ã¤ã®ãƒœãƒƒã‚¯ã‚¹ãŒæ¨ªä¸¦ã³ãªã‚‰ CSS Grid ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
            
            <h4>CSS Flexbox ãƒ†ã‚¹ãƒˆ</h4>
            <div class="flex-test">
                <div style="background: #dc143c; color: white; padding: 10px;">Flex 1</div>
                <div style="background: #8b0000; color: white; padding: 10px;">Flex 2</div>
            </div>
            <div class="test-details">ä¸Šã®2ã¤ã®ãƒœãƒƒã‚¯ã‚¹ãŒä¸¡ç«¯ã«é…ç½®ã•ã‚Œã¦ã„ã‚Œã° Flexbox ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
            
            <h4>CSS Custom Properties ãƒ†ã‚¹ãƒˆ</h4>
            <div class="custom-property-test">ã“ã®ãƒ†ã‚­ã‚¹ãƒˆãŒèµ¤è‰²ãªã‚‰ CSS Custom Properties ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
            
            <h4>CSS Gradient ãƒ†ã‚¹ãƒˆ</h4>
            <div class="fallback-test">ã“ã®ãƒœãƒƒã‚¯ã‚¹ãŒã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã‚‰ CSS Gradient ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™</div>
        </div>
        
        <div class="feature-test">
            <h3>âš¡ JavaScript API ã‚µãƒãƒ¼ãƒˆ</h3>
            <div id="jsFeatures"></div>
            
            <h4>Intersection Observer ãƒ†ã‚¹ãƒˆ</h4>
            <div id="intersectionTest">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>
            
            <h4>Performance API ãƒ†ã‚¹ãƒˆ</h4>
            <div id="performanceTest">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>
            
            <h4>Local Storage ãƒ†ã‚¹ãƒˆ</h4>
            <div id="storageTest">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>
        </div>
        
        <div class="feature-test">
            <h3>ğŸ“± ãƒ‡ãƒã‚¤ã‚¹ãƒ»å…¥åŠ›ã‚µãƒãƒ¼ãƒˆ</h3>
            <div id="deviceFeatures"></div>
        </div>
        
        <div class="feature-test">
            <h3>ğŸ¯ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–æ©Ÿèƒ½</h3>
            <div id="animationFeatures"></div>
        </div>
        
        <div class="feature-test">
            <h3>ğŸ”§ å®Ÿéš›ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="testActualAnimations()">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="animationTestResults"></div>
        </div>
        
        <div class="feature-test">
            <h3>ğŸ“Š è©³ç´°ãƒ†ã‚¹ãƒˆçµæœ</h3>
            <button class="test-button" onclick="exportResults()">çµæœã‚’JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            <button class="test-button" onclick="runFullCompatibilityTest()">å®Œå…¨äº’æ›æ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="detailedResults"></div>
        </div>
    </div>

    <script>
        class BrowserCompatibilityTester {
            constructor() {
                this.results = {
                    browser: {},
                    cssFeatures: {},
                    jsFeatures: {},
                    deviceFeatures: {},
                    animationFeatures: {},
                    score: 0,
                    recommendations: []
                };
                
                this.init();
            }
            
            init() {
                this.detectBrowser();
                this.testCSSFeatures();
                this.testJSFeatures();
                this.testDeviceFeatures();
                this.testAnimationFeatures();
                this.calculateScore();
                this.displayResults();
            }
            
            detectBrowser() {
                const ua = navigator.userAgent;
                const browser = {
                    userAgent: ua,
                    vendor: navigator.vendor || '',
                    platform: navigator.platform || '',
                    language: navigator.language || '',
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                    deviceMemory: navigator.deviceMemory || 'Unknown',
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt
                    } : null
                };
                
                // ãƒ–ãƒ©ã‚¦ã‚¶åã®æ¨å®š
                if (ua.includes('Chrome') && !ua.includes('Edge')) {
                    browser.name = 'Chrome';
                    browser.engine = 'Blink';
                } else if (ua.includes('Firefox')) {
                    browser.name = 'Firefox';
                    browser.engine = 'Gecko';
                } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                    browser.name = 'Safari';
                    browser.engine = 'WebKit';
                } else if (ua.includes('Edge')) {
                    browser.name = 'Edge';
                    browser.engine = 'Blink';
                } else if (ua.includes('Opera')) {
                    browser.name = 'Opera';
                    browser.engine = 'Blink';
                } else {
                    browser.name = 'Unknown';
                    browser.engine = 'Unknown';
                }
                
                this.results.browser = browser;
                
                // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã‚’è¡¨ç¤º
                document.getElementById('browserDetails').innerHTML = `
                    <strong>ãƒ–ãƒ©ã‚¦ã‚¶:</strong> ${browser.name}<br>
                    <strong>ã‚¨ãƒ³ã‚¸ãƒ³:</strong> ${browser.engine}<br>
                    <strong>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :</strong> ${browser.platform}<br>
                    <strong>è¨€èª:</strong> ${browser.language}<br>
                    <strong>CPU ã‚³ã‚¢æ•°:</strong> ${browser.hardwareConcurrency}<br>
                    <strong>ãƒ¡ãƒ¢ãƒª:</strong> ${browser.deviceMemory}GB<br>
                    <strong>æ¥ç¶š:</strong> ${browser.connection ? browser.connection.effectiveType : 'Unknown'}
                `;
            }
            
            testCSSFeatures() {
                const features = {
                    'CSS Animations': this.testCSSAnimations(),
                    'CSS Transitions': this.testCSSTransitions(),
                    'CSS Transforms': this.testCSSTransforms(),
                    'CSS Grid': this.testCSSGrid(),
                    'CSS Flexbox': this.testCSSFlexbox(),
                    'CSS Custom Properties': this.testCSSCustomProperties(),
                    'CSS Gradients': this.testCSSGradients(),
                    'CSS will-change': this.testCSSWillChange(),
                    'CSS calc()': this.testCSSCalc(),
                    'CSS Media Queries': this.testCSSMediaQueries(),
                    'CSS @supports': this.testCSSSupports()
                };
                
                this.results.cssFeatures = features;
                
                const container = document.getElementById('cssFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? 'âœ“' : 'âœ—'}
                    </span>`
                ).join('');
            }
            
            testCSSAnimations() {
                return CSS.supports('animation', 'test 1s') || 
                       CSS.supports('-webkit-animation', 'test 1s') ||
                       CSS.supports('-moz-animation', 'test 1s');
            }
            
            testCSSTransitions() {
                return CSS.supports('transition', 'all 1s') ||
                       CSS.supports('-webkit-transition', 'all 1s') ||
                       CSS.supports('-moz-transition', 'all 1s');
            }
            
            testCSSTransforms() {
                return CSS.supports('transform', 'translateX(0)') ||
                       CSS.supports('-webkit-transform', 'translateX(0)') ||
                       CSS.supports('-moz-transform', 'translateX(0)');
            }
            
            testCSSGrid() {
                return CSS.supports('display', 'grid');
            }
            
            testCSSFlexbox() {
                return CSS.supports('display', 'flex') ||
                       CSS.supports('display', '-webkit-flex');
            }
            
            testCSSCustomProperties() {
                return CSS.supports('--test', '0') || CSS.supports('color', 'var(--test)');
            }
            
            testCSSGradients() {
                return CSS.supports('background', 'linear-gradient(red, blue)') ||
                       CSS.supports('background', '-webkit-linear-gradient(red, blue)');
            }
            
            testCSSWillChange() {
                return CSS.supports('will-change', 'transform');
            }
            
            testCSSCalc() {
                return CSS.supports('width', 'calc(100% - 10px)');
            }
            
            testCSSMediaQueries() {
                return window.matchMedia && window.matchMedia('(min-width: 1px)').matches;
            }
            
            testCSSSupports() {
                return typeof CSS !== 'undefined' && typeof CSS.supports === 'function';
            }
            
            testJSFeatures() {
                const features = {
                    'Intersection Observer': 'IntersectionObserver' in window,
                    'Mutation Observer': 'MutationObserver' in window,
                    'Performance API': 'performance' in window && 'now' in performance,
                    'RequestAnimationFrame': 'requestAnimationFrame' in window,
                    'Local Storage': this.testLocalStorage(),
                    'Session Storage': this.testSessionStorage(),
                    'Fetch API': 'fetch' in window,
                    'Promise': 'Promise' in window,
                    'Arrow Functions': this.testArrowFunctions(),
                    'ES6 Classes': this.testES6Classes(),
                    'Template Literals': this.testTemplateLiterals(),
                    'Async/Await': this.testAsyncAwait(),
                    'Web Workers': 'Worker' in window,
                    'Service Workers': 'serviceWorker' in navigator,
                    'Geolocation': 'geolocation' in navigator,
                    'Device Orientation': 'DeviceOrientationEvent' in window,
                    'Touch Events': 'ontouchstart' in window,
                    'Pointer Events': 'PointerEvent' in window
                };
                
                this.results.jsFeatures = features;
                
                const container = document.getElementById('jsFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? 'âœ“' : 'âœ—'}
                    </span>`
                ).join('');
                
                // å€‹åˆ¥ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                this.runIntersectionObserverTest();
                this.runPerformanceTest();
                this.runStorageTest();
            }
            
            testLocalStorage() {
                try {
                    const test = 'test';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testSessionStorage() {
                try {
                    const test = 'test';
                    sessionStorage.setItem(test, test);
                    sessionStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testArrowFunctions() {
                try {
                    eval('() => {}');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testES6Classes() {
                try {
                    eval('class Test {}');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testTemplateLiterals() {
                try {
                    eval('`template`');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            testAsyncAwait() {
                try {
                    eval('async function test() { await Promise.resolve(); }');
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            runIntersectionObserverTest() {
                const container = document.getElementById('intersectionTest');
                
                if ('IntersectionObserver' in window) {
                    try {
                        const observer = new IntersectionObserver(() => {});
                        observer.disconnect();
                        container.innerHTML = '<span class="test-result supported">Intersection Observer: âœ“ å‹•ä½œç¢ºèªæ¸ˆã¿</span>';
                    } catch (e) {
                        container.innerHTML = '<span class="test-result not-supported">Intersection Observer: âœ— ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</span>';
                    }
                } else {
                    container.innerHTML = '<span class="test-result not-supported">Intersection Observer: âœ— æœªã‚µãƒãƒ¼ãƒˆ</span>';
                }
            }
            
            runPerformanceTest() {
                const container = document.getElementById('performanceTest');
                
                if ('performance' in window && 'now' in performance) {
                    try {
                        const start = performance.now();
                        const end = performance.now();
                        const duration = end - start;
                        container.innerHTML = `<span class="test-result supported">Performance API: âœ“ å‹•ä½œç¢ºèªæ¸ˆã¿ (${duration.toFixed(2)}ms)</span>`;
                    } catch (e) {
                        container.innerHTML = '<span class="test-result not-supported">Performance API: âœ— ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</span>';
                    }
                } else {
                    container.innerHTML = '<span class="test-result not-supported">Performance API: âœ— æœªã‚µãƒãƒ¼ãƒˆ</span>';
                }
            }
            
            runStorageTest() {
                const container = document.getElementById('storageTest');
                
                const localStorageSupported = this.testLocalStorage();
                const sessionStorageSupported = this.testSessionStorage();
                
                container.innerHTML = `
                    <span class="test-result ${localStorageSupported ? 'supported' : 'not-supported'}">
                        Local Storage: ${localStorageSupported ? 'âœ“' : 'âœ—'}
                    </span>
                    <span class="test-result ${sessionStorageSupported ? 'supported' : 'not-supported'}">
                        Session Storage: ${sessionStorageSupported ? 'âœ“' : 'âœ—'}
                    </span>
                `;
            }
            
            testDeviceFeatures() {
                const features = {
                    'Touch Support': 'ontouchstart' in window || navigator.maxTouchPoints > 0,
                    'Pointer Events': 'PointerEvent' in window,
                    'Device Orientation': 'DeviceOrientationEvent' in window,
                    'Device Motion': 'DeviceMotionEvent' in window,
                    'Vibration': 'vibrate' in navigator,
                    'Battery API': 'getBattery' in navigator,
                    'Network Information': 'connection' in navigator,
                    'Media Queries': window.matchMedia && window.matchMedia('(hover: hover)').media !== 'not all',
                    'Reduced Motion': window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches,
                    'High Contrast': window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches,
                    'Dark Mode': window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
                };
                
                this.results.deviceFeatures = features;
                
                const container = document.getElementById('deviceFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? 'âœ“' : 'âœ—'}
                    </span>`
                ).join('');
            }
            
            testAnimationFeatures() {
                const features = {
                    'GPU Acceleration': this.testGPUAcceleration(),
                    'Hardware Acceleration': this.testHardwareAcceleration(),
                    '60fps Support': this.test60FPSSupport(),
                    'Smooth Scrolling': this.testSmoothScrolling(),
                    'Backface Visibility': this.testBackfaceVisibility(),
                    'Transform 3D': this.testTransform3D(),
                    'Perspective': this.testPerspective(),
                    'Filter Effects': this.testFilterEffects(),
                    'Backdrop Filter': this.testBackdropFilter(),
                    'Clip Path': this.testClipPath()
                };
                
                this.results.animationFeatures = features;
                
                const container = document.getElementById('animationFeatures');
                container.innerHTML = Object.entries(features).map(([feature, supported]) => 
                    `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                        ${feature}: ${supported ? 'âœ“' : 'âœ—'}
                    </span>`
                ).join('');
            }
            
            testGPUAcceleration() {
                return CSS.supports('transform', 'translateZ(0)') ||
                       CSS.supports('transform', 'translate3d(0,0,0)');
            }
            
            testHardwareAcceleration() {
                return CSS.supports('will-change', 'transform') ||
                       CSS.supports('transform', 'translateZ(0)');
            }
            
            test60FPSSupport() {
                return 'requestAnimationFrame' in window;
            }
            
            testSmoothScrolling() {
                return CSS.supports('scroll-behavior', 'smooth');
            }
            
            testBackfaceVisibility() {
                return CSS.supports('backface-visibility', 'hidden') ||
                       CSS.supports('-webkit-backface-visibility', 'hidden');
            }
            
            testTransform3D() {
                return CSS.supports('transform', 'rotateX(0deg)') ||
                       CSS.supports('-webkit-transform', 'rotateX(0deg)');
            }
            
            testPerspective() {
                return CSS.supports('perspective', '1000px') ||
                       CSS.supports('-webkit-perspective', '1000px');
            }
            
            testFilterEffects() {
                return CSS.supports('filter', 'blur(5px)') ||
                       CSS.supports('-webkit-filter', 'blur(5px)');
            }
            
            testBackdropFilter() {
                return CSS.supports('backdrop-filter', 'blur(5px)') ||
                       CSS.supports('-webkit-backdrop-filter', 'blur(5px)');
            }
            
            testClipPath() {
                return CSS.supports('clip-path', 'circle(50%)') ||
                       CSS.supports('-webkit-clip-path', 'circle(50%)');
            }
            
            calculateScore() {
                let totalFeatures = 0;
                let supportedFeatures = 0;
                
                // CSSæ©Ÿèƒ½ã®ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé‡ã¿: 30%ï¼‰
                const cssFeatures = Object.values(this.results.cssFeatures);
                totalFeatures += cssFeatures.length * 0.3;
                supportedFeatures += cssFeatures.filter(Boolean).length * 0.3;
                
                // JavaScriptæ©Ÿèƒ½ã®ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé‡ã¿: 25%ï¼‰
                const jsFeatures = Object.values(this.results.jsFeatures);
                totalFeatures += jsFeatures.length * 0.25;
                supportedFeatures += jsFeatures.filter(Boolean).length * 0.25;
                
                // ãƒ‡ãƒã‚¤ã‚¹æ©Ÿèƒ½ã®ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé‡ã¿: 20%ï¼‰
                const deviceFeatures = Object.values(this.results.deviceFeatures);
                totalFeatures += deviceFeatures.length * 0.2;
                supportedFeatures += deviceFeatures.filter(Boolean).length * 0.2;
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé‡ã¿: 25%ï¼‰
                const animationFeatures = Object.values(this.results.animationFeatures);
                totalFeatures += animationFeatures.length * 0.25;
                supportedFeatures += animationFeatures.filter(Boolean).length * 0.25;
                
                this.results.score = Math.round((supportedFeatures / totalFeatures) * 100);
            }
            
            displayResults() {
                const scoreContainer = document.getElementById('compatibilityScore');
                const score = this.results.score;
                
                let scoreClass, scoreText;
                if (score >= 90) {
                    scoreClass = 'score-excellent';
                    scoreText = 'å„ªç§€ - å®Œå…¨äº’æ›';
                } else if (score >= 75) {
                    scoreClass = 'score-good';
                    scoreText = 'è‰¯å¥½ - é«˜äº’æ›æ€§';
                } else if (score >= 60) {
                    scoreClass = 'score-fair';
                    scoreText = 'æ™®é€š - åŸºæœ¬äº’æ›æ€§';
                } else {
                    scoreClass = 'score-poor';
                    scoreText = 'è¦æ”¹å–„ - ä½äº’æ›æ€§';
                }
                
                scoreContainer.className = `compatibility-score ${scoreClass}`;
                scoreContainer.innerHTML = `
                    äº’æ›æ€§ã‚¹ã‚³ã‚¢: ${score}/100<br>
                    <small>${scoreText}</small>
                `;
                
                // æ¨å¥¨äº‹é …ã®ç”Ÿæˆ
                this.generateRecommendations();
            }
            
            generateRecommendations() {
                const recommendations = [];
                
                // é‡è¦ãªæ©Ÿèƒ½ã®æœªã‚µãƒãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
                if (!this.results.cssFeatures['CSS Animations']) {
                    recommendations.push('CSS Animations ãŒæœªã‚µãƒãƒ¼ãƒˆã§ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚');
                }
                
                if (!this.results.cssFeatures['CSS Transitions']) {
                    recommendations.push('CSS Transitions ãŒæœªã‚µãƒãƒ¼ãƒˆã§ã™ã€‚å³åº§ã®çŠ¶æ…‹å¤‰æ›´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚');
                }
                
                if (!this.results.jsFeatures['Intersection Observer']) {
                    recommendations.push('Intersection Observer ãŒæœªã‚µãƒãƒ¼ãƒˆã§ã™ã€‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒªãƒ•ã‚£ãƒ«ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚');
                }
                
                if (!this.results.jsFeatures['RequestAnimationFrame']) {
                    recommendations.push('RequestAnimationFrame ãŒæœªã‚µãƒãƒ¼ãƒˆã§ã™ã€‚setTimeoutã§ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚');
                }
                
                if (!this.results.animationFeatures['GPU Acceleration']) {
                    recommendations.push('GPUåŠ é€ŸãŒæœªã‚µãƒãƒ¼ãƒˆã§ã™ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                }
                
                if (this.results.deviceFeatures['Reduced Motion']) {
                    recommendations.push('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è»½æ¸›ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–ã¾ãŸã¯ç°¡ç´ åŒ–ã—ã¦ãã ã•ã„ã€‚');
                }
                
                this.results.recommendations = recommendations;
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        let compatibilityTester;
        
        function testActualAnimations() {
            const container = document.getElementById('animationTestResults');
            container.innerHTML = '<p>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>';
            
            // å®Ÿéš›ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ã‚’ãƒ†ã‚¹ãƒˆ
            const testElement = document.createElement('div');
            testElement.style.cssText = `
                width: 50px;
                height: 50px;
                background: #dc143c;
                position: relative;
                margin: 10px 0;
                transition: transform 0.5s ease;
                animation: testAnimation 2s infinite;
            `;
            
            container.appendChild(testElement);
            
            setTimeout(() => {
                const computedStyle = window.getComputedStyle(testElement);
                const hasAnimation = computedStyle.animationName !== 'none';
                const hasTransition = computedStyle.transitionProperty !== 'none';
                
                let results = '<h4>å®Ÿéš›ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œçµæœ:</h4>';
                results += `<span class="test-result ${hasAnimation ? 'supported' : 'not-supported'}">
                    CSS Animation: ${hasAnimation ? 'âœ“ å‹•ä½œä¸­' : 'âœ— å‹•ä½œã›ãš'}
                </span>`;
                results += `<span class="test-result ${hasTransition ? 'supported' : 'not-supported'}">
                    CSS Transition: ${hasTransition ? 'âœ“ è¨­å®šæ¸ˆã¿' : 'âœ— æœªè¨­å®š'}
                </span>`;
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
                const startTime = performance.now();
                let frameCount = 0;
                
                function measureFPS() {
                    frameCount++;
                    if (frameCount < 60) {
                        requestAnimationFrame(measureFPS);
                    } else {
                        const endTime = performance.now();
                        const fps = Math.round(60000 / (endTime - startTime));
                        results += `<span class="test-result ${fps >= 30 ? 'supported' : 'not-supported'}">
                            FPS: ${fps} ${fps >= 30 ? '(è‰¯å¥½)' : '(è¦æ”¹å–„)'}
                        </span>`;
                        
                        container.innerHTML = results;
                    }
                }
                
                if ('requestAnimationFrame' in window) {
                    requestAnimationFrame(measureFPS);
                } else {
                    results += '<span class="test-result not-supported">FPSæ¸¬å®š: âœ— RequestAnimationFrameæœªã‚µãƒãƒ¼ãƒˆ</span>';
                    container.innerHTML = results;
                }
                
            }, 1000);
        }
        
        function exportResults() {
            const results = compatibilityTester.results;
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `browser-compatibility-${Date.now()}.json`;
            link.click();
        }
        
        function runFullCompatibilityTest() {
            const container = document.getElementById('detailedResults');
            container.innerHTML = '<p>å®Œå…¨äº’æ›æ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>';
            
            // ã‚ˆã‚Šè©³ç´°ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            const detailedTests = {
                'WebGL Support': testWebGL(),
                'Canvas Support': testCanvas(),
                'SVG Support': testSVG(),
                'Video Support': testVideo(),
                'Audio Support': testAudio(),
                'WebP Support': testWebP(),
                'AVIF Support': testAVIF(),
                'HTTP/2 Support': testHTTP2(),
                'ES6 Modules': testES6Modules(),
                'Web Components': testWebComponents()
            };
            
            let results = '<h4>è©³ç´°äº’æ›æ€§ãƒ†ã‚¹ãƒˆçµæœ:</h4>';
            Object.entries(detailedTests).forEach(([test, supported]) => {
                results += `<span class="test-result ${supported ? 'supported' : 'not-supported'}">
                    ${test}: ${supported ? 'âœ“' : 'âœ—'}
                </span>`;
            });
            
            // æ¨å¥¨äº‹é …ã®è¡¨ç¤º
            if (compatibilityTester.results.recommendations.length > 0) {
                results += '<h4>æ¨å¥¨äº‹é …:</h4><ul>';
                compatibilityTester.results.recommendations.forEach(rec => {
                    results += `<li>${rec}</li>`;
                });
                results += '</ul>';
            }
            
            container.innerHTML = results;
        }
        
        // è©³ç´°ãƒ†ã‚¹ãƒˆé–¢æ•°
        function testWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
            } catch (e) {
                return false;
            }
        }
        
        function testCanvas() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext && canvas.getContext('2d'));
            } catch (e) {
                return false;
            }
        }
        
        function testSVG() {
            return !!(document.createElementNS && document.createElementNS('http://www.w3.org/2000/svg', 'svg').createSVGRect);
        }
        
        function testVideo() {
            return !!document.createElement('video').canPlayType;
        }
        
        function testAudio() {
            return !!document.createElement('audio').canPlayType;
        }
        
        function testWebP() {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 1;
            return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
        }
        
        function testAVIF() {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 1;
            try {
                return canvas.toDataURL('image/avif').indexOf('data:image/avif') === 0;
            } catch (e) {
                return false;
            }
        }
        
        function testHTTP2() {
            // HTTP/2ã®ç›´æ¥ãƒ†ã‚¹ãƒˆã¯å›°é›£ãªã®ã§ã€é–¢é€£æ©Ÿèƒ½ã‚’ãƒã‚§ãƒƒã‚¯
            return 'serviceWorker' in navigator && 'fetch' in window;
        }
        
        function testES6Modules() {
            try {
                return typeof Symbol !== 'undefined' && 'import' in document.createElement('script');
            } catch (e) {
                return false;
            }
        }
        
        function testWebComponents() {
            return 'customElements' in window && 'attachShadow' in Element.prototype;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            compatibilityTester = new BrowserCompatibilityTester();
        });
    </script>
</body>
</html>
